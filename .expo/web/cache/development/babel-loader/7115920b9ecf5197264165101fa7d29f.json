{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { SharedEventEmitter } from \"../../utils/events\";\nimport INTERNALS from \"../../utils/internals\";\nimport { getLogger } from \"../../utils/log\";\nimport ModuleBase from \"../../utils/ModuleBase\";\nimport { getNativeModule } from \"../../utils/native\";\nimport { isFunction, isObject } from \"../../utils\";\nimport IOSMessaging from \"./IOSMessaging\";\nimport RemoteMessage from \"./RemoteMessage\";\nvar NATIVE_EVENTS = ['messaging_message_received', 'messaging_token_refreshed'];\nexport var MODULE_NAME = 'RNFirebaseMessaging';\nexport var NAMESPACE = 'messaging';\n\nvar Messaging = function (_ModuleBase) {\n  _inherits(Messaging, _ModuleBase);\n\n  var _super = _createSuper(Messaging);\n\n  function Messaging(app) {\n    var _this;\n\n    _classCallCheck(this, Messaging);\n\n    _this = _super.call(this, app, {\n      events: NATIVE_EVENTS,\n      moduleName: MODULE_NAME,\n      hasMultiAppSupport: false,\n      hasCustomUrlSupport: false,\n      namespace: NAMESPACE\n    });\n    _this._ios = new IOSMessaging(_assertThisInitialized(_this));\n    SharedEventEmitter.addListener('messaging_message_received', function (message) {\n      SharedEventEmitter.emit('onMessage', new RemoteMessage(message));\n    });\n    SharedEventEmitter.addListener('messaging_token_refreshed', function (token) {\n      SharedEventEmitter.emit('onTokenRefresh', token);\n    });\n\n    if (Platform.OS === 'ios') {\n      getNativeModule(_assertThisInitialized(_this)).jsInitialised();\n    }\n\n    return _this;\n  }\n\n  _createClass(Messaging, [{\n    key: \"getToken\",\n    value: function getToken() {\n      return getNativeModule(this).getToken();\n    }\n  }, {\n    key: \"deleteToken\",\n    value: function deleteToken() {\n      return getNativeModule(this).deleteToken();\n    }\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(nextOrObserver) {\n      var _this2 = this;\n\n      var listener;\n\n      if (isFunction(nextOrObserver)) {\n        listener = nextOrObserver;\n      } else if (isObject(nextOrObserver) && isFunction(nextOrObserver.next)) {\n        listener = nextOrObserver.next;\n      } else {\n        throw new Error('Messaging.onMessage failed: First argument must be a function or observer object with a `next` function.');\n      }\n\n      getLogger(this).info('Creating onMessage listener');\n      SharedEventEmitter.addListener('onMessage', listener);\n      return function () {\n        getLogger(_this2).info('Removing onMessage listener');\n        SharedEventEmitter.removeListener('onMessage', listener);\n      };\n    }\n  }, {\n    key: \"onTokenRefresh\",\n    value: function onTokenRefresh(nextOrObserver) {\n      var _this3 = this;\n\n      var listener;\n\n      if (isFunction(nextOrObserver)) {\n        listener = nextOrObserver;\n      } else if (isObject(nextOrObserver) && isFunction(nextOrObserver.next)) {\n        listener = nextOrObserver.next;\n      } else {\n        throw new Error('Messaging.onTokenRefresh failed: First argument must be a function or observer object with a `next` function.');\n      }\n\n      getLogger(this).info('Creating onTokenRefresh listener');\n      SharedEventEmitter.addListener('onTokenRefresh', listener);\n      return function () {\n        getLogger(_this3).info('Removing onTokenRefresh listener');\n        SharedEventEmitter.removeListener('onTokenRefresh', listener);\n      };\n    }\n  }, {\n    key: \"requestPermission\",\n    value: function requestPermission() {\n      return getNativeModule(this).requestPermission();\n    }\n  }, {\n    key: \"hasPermission\",\n    value: function hasPermission() {\n      return getNativeModule(this).hasPermission();\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage(remoteMessage) {\n      if (!(remoteMessage instanceof RemoteMessage)) {\n        return Promise.reject(new Error(\"Messaging:sendMessage expects a 'RemoteMessage' but got type \" + typeof remoteMessage));\n      }\n\n      try {\n        return getNativeModule(this).sendMessage(remoteMessage.build());\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    }\n  }, {\n    key: \"subscribeToTopic\",\n    value: function subscribeToTopic(topic) {\n      return getNativeModule(this).subscribeToTopic(topic);\n    }\n  }, {\n    key: \"unsubscribeFromTopic\",\n    value: function unsubscribeFromTopic(topic) {\n      return getNativeModule(this).unsubscribeFromTopic(topic);\n    }\n  }, {\n    key: \"setBackgroundMessageHandler\",\n    value: function setBackgroundMessageHandler() {\n      throw new Error(INTERNALS.STRINGS.ERROR_UNSUPPORTED_MODULE_METHOD('messaging', 'setBackgroundMessageHandler'));\n    }\n  }, {\n    key: \"useServiceWorker\",\n    value: function useServiceWorker() {\n      throw new Error(INTERNALS.STRINGS.ERROR_UNSUPPORTED_MODULE_METHOD('messaging', 'useServiceWorker'));\n    }\n  }, {\n    key: \"ios\",\n    get: function get() {\n      return this._ios;\n    }\n  }]);\n\n  return Messaging;\n}(ModuleBase);\n\nexport { Messaging as default };\nexport var statics = {\n  RemoteMessage: RemoteMessage\n};","map":{"version":3,"sources":["C:/Users/fong/Desktop/code-18122020-combined/node_modules/react-native-firebase/dist/modules/messaging/index.js"],"names":["SharedEventEmitter","INTERNALS","getLogger","ModuleBase","getNativeModule","isFunction","isObject","IOSMessaging","RemoteMessage","NATIVE_EVENTS","MODULE_NAME","NAMESPACE","Messaging","app","events","moduleName","hasMultiAppSupport","hasCustomUrlSupport","namespace","_ios","addListener","message","emit","token","Platform","OS","jsInitialised","getToken","deleteToken","nextOrObserver","listener","next","Error","info","removeListener","requestPermission","hasPermission","remoteMessage","Promise","reject","sendMessage","build","error","topic","subscribeToTopic","unsubscribeFromTopic","STRINGS","ERROR_UNSUPPORTED_MODULE_METHOD","statics"],"mappings":"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","sourcesContent":["/**\n * \n * Messaging (FCM) representation wrapper\n */\nimport { Platform } from 'react-native';\nimport { SharedEventEmitter } from '../../utils/events';\nimport INTERNALS from '../../utils/internals';\nimport { getLogger } from '../../utils/log';\nimport ModuleBase from '../../utils/ModuleBase';\nimport { getNativeModule } from '../../utils/native';\nimport { isFunction, isObject } from '../../utils';\nimport IOSMessaging from './IOSMessaging';\nimport RemoteMessage from './RemoteMessage';\nconst NATIVE_EVENTS = ['messaging_message_received', 'messaging_token_refreshed'];\nexport const MODULE_NAME = 'RNFirebaseMessaging';\nexport const NAMESPACE = 'messaging';\n/**\n * @class Messaging\n */\n\nexport default class Messaging extends ModuleBase {\n  constructor(app) {\n    super(app, {\n      events: NATIVE_EVENTS,\n      moduleName: MODULE_NAME,\n      hasMultiAppSupport: false,\n      hasCustomUrlSupport: false,\n      namespace: NAMESPACE\n    });\n    this._ios = new IOSMessaging(this);\n    SharedEventEmitter.addListener( // sub to internal native event - this fans out to\n    // public event name: onMessage\n    'messaging_message_received', message => {\n      SharedEventEmitter.emit('onMessage', new RemoteMessage(message));\n    });\n    SharedEventEmitter.addListener( // sub to internal native event - this fans out to\n    // public event name: onMessage\n    'messaging_token_refreshed', token => {\n      SharedEventEmitter.emit('onTokenRefresh', token);\n    }); // Tell the native module that we're ready to receive events\n\n    if (Platform.OS === 'ios') {\n      getNativeModule(this).jsInitialised();\n    }\n  }\n\n  get ios() {\n    return this._ios;\n  }\n\n  getToken() {\n    return getNativeModule(this).getToken();\n  }\n\n  deleteToken() {\n    return getNativeModule(this).deleteToken();\n  }\n\n  onMessage(nextOrObserver) {\n    let listener;\n\n    if (isFunction(nextOrObserver)) {\n      // $FlowExpectedError: Not coping with the overloaded method signature\n      listener = nextOrObserver;\n    } else if (isObject(nextOrObserver) && isFunction(nextOrObserver.next)) {\n      listener = nextOrObserver.next;\n    } else {\n      throw new Error('Messaging.onMessage failed: First argument must be a function or observer object with a `next` function.');\n    }\n\n    getLogger(this).info('Creating onMessage listener');\n    SharedEventEmitter.addListener('onMessage', listener);\n    return () => {\n      getLogger(this).info('Removing onMessage listener');\n      SharedEventEmitter.removeListener('onMessage', listener);\n    };\n  }\n\n  onTokenRefresh(nextOrObserver) {\n    let listener;\n\n    if (isFunction(nextOrObserver)) {\n      // $FlowExpectedError: Not coping with the overloaded method signature\n      listener = nextOrObserver;\n    } else if (isObject(nextOrObserver) && isFunction(nextOrObserver.next)) {\n      listener = nextOrObserver.next;\n    } else {\n      throw new Error('Messaging.onTokenRefresh failed: First argument must be a function or observer object with a `next` function.');\n    }\n\n    getLogger(this).info('Creating onTokenRefresh listener');\n    SharedEventEmitter.addListener('onTokenRefresh', listener);\n    return () => {\n      getLogger(this).info('Removing onTokenRefresh listener');\n      SharedEventEmitter.removeListener('onTokenRefresh', listener);\n    };\n  }\n\n  requestPermission() {\n    return getNativeModule(this).requestPermission();\n  }\n  /**\n   * NON WEB-SDK METHODS\n   */\n\n\n  hasPermission() {\n    return getNativeModule(this).hasPermission();\n  }\n\n  sendMessage(remoteMessage) {\n    if (!(remoteMessage instanceof RemoteMessage)) {\n      return Promise.reject(new Error(`Messaging:sendMessage expects a 'RemoteMessage' but got type ${typeof remoteMessage}`));\n    }\n\n    try {\n      return getNativeModule(this).sendMessage(remoteMessage.build());\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  subscribeToTopic(topic) {\n    return getNativeModule(this).subscribeToTopic(topic);\n  }\n\n  unsubscribeFromTopic(topic) {\n    return getNativeModule(this).unsubscribeFromTopic(topic);\n  }\n  /**\n   * KNOWN UNSUPPORTED METHODS\n   */\n\n\n  setBackgroundMessageHandler() {\n    throw new Error(INTERNALS.STRINGS.ERROR_UNSUPPORTED_MODULE_METHOD('messaging', 'setBackgroundMessageHandler'));\n  }\n\n  useServiceWorker() {\n    throw new Error(INTERNALS.STRINGS.ERROR_UNSUPPORTED_MODULE_METHOD('messaging', 'useServiceWorker'));\n  }\n\n}\nexport const statics = {\n  RemoteMessage\n};"]},"metadata":{},"sourceType":"module"}