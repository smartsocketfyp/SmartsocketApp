{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Query from \"./Query\";\nimport DataSnapshot from \"./DataSnapshot\";\nimport OnDisconnect from \"./OnDisconnect\";\nimport { getLogger } from \"../../utils/log\";\nimport { getNativeModule } from \"../../utils/native\";\nimport ReferenceBase from \"../../utils/ReferenceBase\";\nimport { promiseOrCallback, isFunction, isObject, isString, tryJSONParse, tryJSONStringify, generatePushID } from \"../../utils\";\nimport SyncTree from \"../../utils/SyncTree\";\nvar listeners = 0;\nvar ReferenceEventTypes = {\n  value: 'value',\n  child_added: 'child_added',\n  child_removed: 'child_removed',\n  child_changed: 'child_changed',\n  child_moved: 'child_moved'\n};\n\nvar Reference = function (_ReferenceBase) {\n  _inherits(Reference, _ReferenceBase);\n\n  var _super = _createSuper(Reference);\n\n  function Reference(database, path, existingModifiers) {\n    var _this;\n\n    _classCallCheck(this, Reference);\n\n    _this = _super.call(this, path);\n    _this._refListeners = {};\n    _this._database = database;\n    _this._query = new Query(_assertThisInitialized(_this), existingModifiers);\n    getLogger(database).debug('Created new Reference', _this._getRefKey());\n    return _this;\n  }\n\n  _createClass(Reference, [{\n    key: \"keepSynced\",\n    value: function keepSynced(bool) {\n      return getNativeModule(this._database).keepSynced(this._getRefKey(), this.path, this._query.getModifiers(), bool);\n    }\n  }, {\n    key: \"set\",\n    value: function set(value, onComplete) {\n      return promiseOrCallback(getNativeModule(this._database).set(this.path, this._serializeAnyType(value)), onComplete);\n    }\n  }, {\n    key: \"setPriority\",\n    value: function setPriority(priority, onComplete) {\n      var _priority = this._serializeAnyType(priority);\n\n      return promiseOrCallback(getNativeModule(this._database).setPriority(this.path, _priority), onComplete);\n    }\n  }, {\n    key: \"setWithPriority\",\n    value: function setWithPriority(value, priority, onComplete) {\n      var _value = this._serializeAnyType(value);\n\n      var _priority = this._serializeAnyType(priority);\n\n      return promiseOrCallback(getNativeModule(this._database).setWithPriority(this.path, _value, _priority), onComplete);\n    }\n  }, {\n    key: \"update\",\n    value: function update(val, onComplete) {\n      var value = this._serializeObject(val);\n\n      return promiseOrCallback(getNativeModule(this._database).update(this.path, value), onComplete);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(onComplete) {\n      return promiseOrCallback(getNativeModule(this._database).remove(this.path), onComplete);\n    }\n  }, {\n    key: \"transaction\",\n    value: function transaction(transactionUpdate, onComplete) {\n      var _this2 = this;\n\n      var applyLocally = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      if (!isFunction(transactionUpdate)) {\n        return Promise.reject(new Error('Missing transactionUpdate function argument.'));\n      }\n\n      return new Promise(function (resolve, reject) {\n        var onCompleteWrapper = function onCompleteWrapper(error, committed, snapshotData) {\n          if (isFunction(onComplete)) {\n            if (error) {\n              onComplete(error, committed, null);\n            } else {\n              onComplete(null, committed, new DataSnapshot(_this2, snapshotData));\n            }\n          }\n\n          if (error) return reject(error);\n          return resolve({\n            committed: committed,\n            snapshot: new DataSnapshot(_this2, snapshotData)\n          });\n        };\n\n        _this2._database._transactionHandler.add(_this2, transactionUpdate, onCompleteWrapper, applyLocally);\n      });\n    }\n  }, {\n    key: \"once\",\n    value: function once() {\n      var _this3 = this;\n\n      var eventName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'value';\n      var successCallback = arguments.length > 1 ? arguments[1] : undefined;\n      var cancelOrContext = arguments.length > 2 ? arguments[2] : undefined;\n      var context = arguments.length > 3 ? arguments[3] : undefined;\n      return getNativeModule(this._database).once(this._getRefKey(), this.path, this._query.getModifiers(), eventName).then(function (_ref) {\n        var snapshot = _ref.snapshot;\n\n        var _snapshot = new DataSnapshot(_this3, snapshot);\n\n        if (isFunction(successCallback)) {\n          if (isObject(cancelOrContext)) successCallback.bind(cancelOrContext)(_snapshot);\n          if (context && isObject(context)) successCallback.bind(context)(_snapshot);\n          successCallback(_snapshot);\n        }\n\n        return _snapshot;\n      }).catch(function (error) {\n        if (isFunction(cancelOrContext)) return cancelOrContext(error);\n        throw error;\n      });\n    }\n  }, {\n    key: \"push\",\n    value: function push(value, onComplete) {\n      var name = generatePushID(this._database._serverTimeOffset);\n      var pushRef = this.child(name);\n      var thennablePushRef = this.child(name);\n      var promise;\n\n      if (value != null) {\n        promise = thennablePushRef.set(value, onComplete).then(function () {\n          return pushRef;\n        });\n      } else {\n        promise = Promise.resolve(pushRef);\n      }\n\n      thennablePushRef.then = promise.then.bind(promise);\n      thennablePushRef.catch = promise.catch.bind(promise);\n\n      if (isFunction(onComplete)) {\n        promise.catch(function () {});\n      }\n\n      return thennablePushRef;\n    }\n  }, {\n    key: \"orderByKey\",\n    value: function orderByKey() {\n      return this.orderBy('orderByKey');\n    }\n  }, {\n    key: \"orderByPriority\",\n    value: function orderByPriority() {\n      return this.orderBy('orderByPriority');\n    }\n  }, {\n    key: \"orderByValue\",\n    value: function orderByValue() {\n      return this.orderBy('orderByValue');\n    }\n  }, {\n    key: \"orderByChild\",\n    value: function orderByChild(key) {\n      return this.orderBy('orderByChild', key);\n    }\n  }, {\n    key: \"orderBy\",\n    value: function orderBy(name, key) {\n      var newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n      newRef._query.orderBy(name, key);\n\n      return newRef;\n    }\n  }, {\n    key: \"limitToLast\",\n    value: function limitToLast(limit) {\n      return this.limit('limitToLast', limit);\n    }\n  }, {\n    key: \"limitToFirst\",\n    value: function limitToFirst(limit) {\n      return this.limit('limitToFirst', limit);\n    }\n  }, {\n    key: \"limit\",\n    value: function limit(name, _limit) {\n      var newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n      newRef._query.limit(name, _limit);\n\n      return newRef;\n    }\n  }, {\n    key: \"equalTo\",\n    value: function equalTo(value, key) {\n      return this.filter('equalTo', value, key);\n    }\n  }, {\n    key: \"endAt\",\n    value: function endAt(value, key) {\n      return this.filter('endAt', value, key);\n    }\n  }, {\n    key: \"startAt\",\n    value: function startAt(value, key) {\n      return this.filter('startAt', value, key);\n    }\n  }, {\n    key: \"filter\",\n    value: function filter(name, value, key) {\n      var newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n      newRef._query.filter(name, value, key);\n\n      return newRef;\n    }\n  }, {\n    key: \"onDisconnect\",\n    value: function onDisconnect() {\n      return new OnDisconnect(this);\n    }\n  }, {\n    key: \"child\",\n    value: function child(path) {\n      return new Reference(this._database, this.path + \"/\" + path);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return \"\" + this._database.databaseUrl + this.path;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return this.toString();\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(otherRef) {\n      return !!otherRef && otherRef.constructor === Reference && otherRef.key === this.key && this._query.queryIdentifier() === otherRef._query.queryIdentifier();\n    }\n  }, {\n    key: \"_getRegistrationKey\",\n    value: function _getRegistrationKey(eventType) {\n      return \"$\" + this._database.databaseUrl + \"$/\" + this.path + \"$\" + this._query.queryIdentifier() + \"$\" + listeners + \"$\" + eventType;\n    }\n  }, {\n    key: \"_getRefKey\",\n    value: function _getRefKey() {\n      return \"$\" + this._database.databaseUrl + \"$/\" + this.path + \"$\" + this._query.queryIdentifier();\n    }\n  }, {\n    key: \"_serializeObject\",\n    value: function _serializeObject(obj) {\n      if (!isObject(obj)) return obj;\n      return tryJSONParse(tryJSONStringify(obj));\n    }\n  }, {\n    key: \"_serializeAnyType\",\n    value: function _serializeAnyType(value) {\n      if (isObject(value)) {\n        return {\n          type: 'object',\n          value: this._serializeObject(value)\n        };\n      }\n\n      return {\n        type: typeof value,\n        value: value\n      };\n    }\n  }, {\n    key: \"on\",\n    value: function on(eventType, callback, cancelCallbackOrContext, context) {\n      if (!eventType) {\n        throw new Error('Query.on failed: Function called with 0 arguments. Expects at least 2.');\n      }\n\n      if (!isString(eventType) || !ReferenceEventTypes[eventType]) {\n        throw new Error(\"Query.on failed: First argument must be a valid string event type: \\\"\" + Object.keys(ReferenceEventTypes).join(', ') + \"\\\"\");\n      }\n\n      if (!callback) {\n        throw new Error('Query.on failed: Function called with 1 argument. Expects at least 2.');\n      }\n\n      if (!isFunction(callback)) {\n        throw new Error('Query.on failed: Second argument must be a valid function.');\n      }\n\n      if (cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) && !isObject(context) && !isObject(cancelCallbackOrContext)) {\n        throw new Error('Query.on failed: Function called with 3 arguments, but third optional argument `cancelCallbackOrContext` was not a function.');\n      }\n\n      if (cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) && context) {\n        throw new Error('Query.on failed: Function called with 4 arguments, but third optional argument `cancelCallbackOrContext` was not a function.');\n      }\n\n      var eventRegistrationKey = this._getRegistrationKey(eventType);\n\n      var registrationCancellationKey = eventRegistrationKey + \"$cancelled\";\n\n      var _context = cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) ? cancelCallbackOrContext : context;\n\n      var registrationObj = {\n        eventType: eventType,\n        ref: this,\n        path: this.path,\n        key: this._getRefKey(),\n        appName: this._database.app.name,\n        dbURL: this._database.databaseUrl,\n        eventRegistrationKey: eventRegistrationKey\n      };\n      SyncTree.addRegistration(_objectSpread(_objectSpread({}, registrationObj), {}, {\n        listener: _context ? callback.bind(_context) : callback\n      }));\n\n      if (cancelCallbackOrContext && isFunction(cancelCallbackOrContext)) {\n        SyncTree.addRegistration({\n          ref: this,\n          once: true,\n          path: this.path,\n          key: this._getRefKey(),\n          appName: this._database.app.name,\n          dbURL: this._database.databaseUrl,\n          eventType: eventType + \"$cancelled\",\n          eventRegistrationKey: registrationCancellationKey,\n          listener: _context ? cancelCallbackOrContext.bind(_context) : cancelCallbackOrContext\n        });\n      }\n\n      getNativeModule(this._database).on({\n        eventType: eventType,\n        path: this.path,\n        key: this._getRefKey(),\n        appName: this._database.app.name,\n        modifiers: this._query.getModifiers(),\n        hasCancellationCallback: isFunction(cancelCallbackOrContext),\n        registration: {\n          eventRegistrationKey: eventRegistrationKey,\n          key: registrationObj.key,\n          registrationCancellationKey: registrationCancellationKey\n        }\n      });\n      listeners += 1;\n      return callback;\n    }\n  }, {\n    key: \"off\",\n    value: function off() {\n      var eventType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var originalCallback = arguments.length > 1 ? arguments[1] : undefined;\n\n      if (!arguments.length) {\n        return SyncTree.removeListenersForRegistrations(SyncTree.getRegistrationsByPath(this.path));\n      }\n\n      if (eventType && (!isString(eventType) || !ReferenceEventTypes[eventType])) {\n        throw new Error(\"Query.off failed: First argument must be a valid string event type: \\\"\" + Object.keys(ReferenceEventTypes).join(', ') + \"\\\"\");\n      }\n\n      if (originalCallback && !isFunction(originalCallback)) {\n        throw new Error('Query.off failed: Function called with 2 arguments, but second optional argument was not a function.');\n      }\n\n      if (eventType && originalCallback) {\n        var registration = SyncTree.getOneByPathEventListener(this.path, eventType, originalCallback);\n        if (!registration) return [];\n        SyncTree.removeListenersForRegistrations([registration + \"$cancelled\"]);\n        return SyncTree.removeListenerRegistrations(originalCallback, [registration]);\n      }\n\n      var registrations = SyncTree.getRegistrationsByPathEvent(this.path, eventType);\n      SyncTree.removeListenersForRegistrations(SyncTree.getRegistrationsByPathEvent(this.path, eventType + \"$cancelled\"));\n      return SyncTree.removeListenersForRegistrations(registrations);\n    }\n  }, {\n    key: \"parent\",\n    get: function get() {\n      if (this.path === '/') return null;\n      return new Reference(this._database, this.path.substring(0, this.path.lastIndexOf('/')));\n    }\n  }, {\n    key: \"ref\",\n    get: function get() {\n      return this;\n    }\n  }, {\n    key: \"root\",\n    get: function get() {\n      return new Reference(this._database, '/');\n    }\n  }]);\n\n  return Reference;\n}(ReferenceBase);\n\nexport { Reference as default };","map":{"version":3,"sources":["C:/Users/fong/Desktop/code-18122020-combined/node_modules/react-native-firebase/dist/modules/database/Reference.js"],"names":["Query","DataSnapshot","OnDisconnect","getLogger","getNativeModule","ReferenceBase","promiseOrCallback","isFunction","isObject","isString","tryJSONParse","tryJSONStringify","generatePushID","SyncTree","listeners","ReferenceEventTypes","value","child_added","child_removed","child_changed","child_moved","Reference","database","path","existingModifiers","_refListeners","_database","_query","debug","_getRefKey","bool","keepSynced","getModifiers","onComplete","set","_serializeAnyType","priority","_priority","setPriority","_value","setWithPriority","val","_serializeObject","update","remove","transactionUpdate","applyLocally","Promise","reject","Error","resolve","onCompleteWrapper","error","committed","snapshotData","snapshot","_transactionHandler","add","eventName","successCallback","cancelOrContext","context","once","then","_snapshot","bind","catch","name","_serverTimeOffset","pushRef","child","thennablePushRef","promise","orderBy","key","newRef","limit","filter","databaseUrl","toString","otherRef","constructor","queryIdentifier","eventType","obj","type","callback","cancelCallbackOrContext","Object","keys","join","eventRegistrationKey","_getRegistrationKey","registrationCancellationKey","_context","registrationObj","ref","appName","app","dbURL","addRegistration","listener","on","modifiers","hasCancellationCallback","registration","originalCallback","arguments","length","removeListenersForRegistrations","getRegistrationsByPath","getOneByPathEventListener","removeListenerRegistrations","registrations","getRegistrationsByPathEvent","substring","lastIndexOf"],"mappings":"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","sourcesContent":["/**\n * \n * Database Reference representation wrapper\n */\nimport Query from './Query';\nimport DataSnapshot from './DataSnapshot';\nimport OnDisconnect from './OnDisconnect';\nimport { getLogger } from '../../utils/log';\nimport { getNativeModule } from '../../utils/native';\nimport ReferenceBase from '../../utils/ReferenceBase';\nimport { promiseOrCallback, isFunction, isObject, isString, tryJSONParse, tryJSONStringify, generatePushID } from '../../utils';\nimport SyncTree from '../../utils/SyncTree';\n// track all event registrations by path\nlet listeners = 0;\n/**\n * Enum for event types\n * @readonly\n * @enum {String}\n */\n\nconst ReferenceEventTypes = {\n  value: 'value',\n  child_added: 'child_added',\n  child_removed: 'child_removed',\n  child_changed: 'child_changed',\n  child_moved: 'child_moved'\n};\n\n/**\n * @typedef {String} ReferenceLocation - Path to location in the database, relative\n * to the root reference. Consists of a path where segments are separated by a\n * forward slash (/) and ends in a ReferenceKey - except the root location, which\n * has no ReferenceKey.\n *\n * @example\n * // root reference location: '/'\n * // non-root reference: '/path/to/referenceKey'\n */\n\n/**\n * @typedef {String} ReferenceKey - Identifier for each location that is unique to that\n * location, within the scope of its parent. The last part of a ReferenceLocation.\n */\n\n/**\n * Represents a specific location in your Database that can be used for\n * reading or writing data.\n *\n * You can reference the root using firebase.database().ref() or a child location\n * by calling firebase.database().ref(\"child/path\").\n *\n * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference\n * @class Reference\n * @extends ReferenceBase\n */\nexport default class Reference extends ReferenceBase {\n  constructor(database, path, existingModifiers) {\n    super(path);\n    this._refListeners = {};\n    this._database = database;\n    this._query = new Query(this, existingModifiers);\n    getLogger(database).debug('Created new Reference', this._getRefKey());\n  }\n  /**\n   * By calling `keepSynced(true)` on a location, the data for that location will\n   * automatically be downloaded and kept in sync, even when no listeners are\n   * attached for that location. Additionally, while a location is kept synced,\n   *  it will not be evicted from the persistent disk cache.\n   *\n   * @link https://firebase.google.com/docs/reference/android/com/google/firebase/database/Query.html#keepSynced(boolean)\n   * @param bool\n   * @returns {*}\n   */\n\n\n  keepSynced(bool) {\n    return getNativeModule(this._database).keepSynced(this._getRefKey(), this.path, this._query.getModifiers(), bool);\n  }\n  /**\n   * Writes data to this Database location.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#set\n   * @param value\n   * @param onComplete\n   * @returns {Promise}\n   */\n\n\n  set(value, onComplete) {\n    return promiseOrCallback(getNativeModule(this._database).set(this.path, this._serializeAnyType(value)), onComplete);\n  }\n  /**\n   * Sets a priority for the data at this Database location.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#setPriority\n   * @param priority\n   * @param onComplete\n   * @returns {Promise}\n   */\n\n\n  setPriority(priority, onComplete) {\n    const _priority = this._serializeAnyType(priority);\n\n    return promiseOrCallback(getNativeModule(this._database).setPriority(this.path, _priority), onComplete);\n  }\n  /**\n   * Writes data the Database location. Like set() but also specifies the priority for that data.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#setWithPriority\n   * @param value\n   * @param priority\n   * @param onComplete\n   * @returns {Promise}\n   */\n\n\n  setWithPriority(value, priority, onComplete) {\n    const _value = this._serializeAnyType(value);\n\n    const _priority = this._serializeAnyType(priority);\n\n    return promiseOrCallback(getNativeModule(this._database).setWithPriority(this.path, _value, _priority), onComplete);\n  }\n  /**\n   * Writes multiple values to the Database at once.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#update\n   * @param val\n   * @param onComplete\n   * @returns {Promise}\n   */\n\n\n  update(val, onComplete) {\n    const value = this._serializeObject(val);\n\n    return promiseOrCallback(getNativeModule(this._database).update(this.path, value), onComplete);\n  }\n  /**\n   * Removes the data at this Database location.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#remove\n   * @param onComplete\n   * @return {Promise}\n   */\n\n\n  remove(onComplete) {\n    return promiseOrCallback(getNativeModule(this._database).remove(this.path), onComplete);\n  }\n  /**\n   * Atomically modifies the data at this location.\n   *\n   * @link https://firebase.google.com/docs/reference/js/firebase.database.Reference#transaction\n   * @param transactionUpdate\n   * @param onComplete\n   * @param applyLocally\n   */\n\n\n  transaction(transactionUpdate, onComplete, applyLocally = false) {\n    if (!isFunction(transactionUpdate)) {\n      return Promise.reject(new Error('Missing transactionUpdate function argument.'));\n    }\n\n    return new Promise((resolve, reject) => {\n      const onCompleteWrapper = (error, committed, snapshotData) => {\n        if (isFunction(onComplete)) {\n          if (error) {\n            onComplete(error, committed, null);\n          } else {\n            onComplete(null, committed, new DataSnapshot(this, snapshotData));\n          }\n        }\n\n        if (error) return reject(error);\n        return resolve({\n          committed,\n          snapshot: new DataSnapshot(this, snapshotData)\n        });\n      }; // start the transaction natively\n\n\n      this._database._transactionHandler.add(this, transactionUpdate, onCompleteWrapper, applyLocally);\n    });\n  }\n  /**\n   *\n   * @param eventName\n   * @param successCallback\n   * @param cancelOrContext\n   * @param context\n   * @returns {Promise.<any>}\n   */\n\n\n  once(eventName = 'value', successCallback, cancelOrContext, context) {\n    return getNativeModule(this._database).once(this._getRefKey(), this.path, this._query.getModifiers(), eventName).then(({\n      snapshot\n    }) => {\n      const _snapshot = new DataSnapshot(this, snapshot);\n\n      if (isFunction(successCallback)) {\n        if (isObject(cancelOrContext)) successCallback.bind(cancelOrContext)(_snapshot);\n        if (context && isObject(context)) successCallback.bind(context)(_snapshot);\n        successCallback(_snapshot);\n      }\n\n      return _snapshot;\n    }).catch(error => {\n      if (isFunction(cancelOrContext)) return cancelOrContext(error);\n      throw error;\n    });\n  }\n  /**\n   *\n   * @param value\n   * @param onComplete\n   * @returns {*}\n   */\n\n\n  push(value, onComplete) {\n    const name = generatePushID(this._database._serverTimeOffset);\n    const pushRef = this.child(name);\n    const thennablePushRef = this.child(name);\n    let promise;\n\n    if (value != null) {\n      promise = thennablePushRef.set(value, onComplete).then(() => pushRef);\n    } else {\n      promise = Promise.resolve(pushRef);\n    }\n\n    thennablePushRef.then = promise.then.bind(promise);\n    thennablePushRef.catch = promise.catch.bind(promise);\n\n    if (isFunction(onComplete)) {\n      promise.catch(() => {});\n    }\n\n    return thennablePushRef;\n  }\n  /**\n   * MODIFIERS\n   */\n\n  /**\n   *\n   * @returns {Reference}\n   */\n\n\n  orderByKey() {\n    return this.orderBy('orderByKey');\n  }\n  /**\n   *\n   * @returns {Reference}\n   */\n\n\n  orderByPriority() {\n    return this.orderBy('orderByPriority');\n  }\n  /**\n   *\n   * @returns {Reference}\n   */\n\n\n  orderByValue() {\n    return this.orderBy('orderByValue');\n  }\n  /**\n   *\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  orderByChild(key) {\n    return this.orderBy('orderByChild', key);\n  }\n  /**\n   *\n   * @param name\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  orderBy(name, key) {\n    const newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n    newRef._query.orderBy(name, key);\n\n    return newRef;\n  }\n  /**\n   * LIMITS\n   */\n\n  /**\n   *\n   * @param limit\n   * @returns {Reference}\n   */\n\n\n  limitToLast(limit) {\n    return this.limit('limitToLast', limit);\n  }\n  /**\n   *\n   * @param limit\n   * @returns {Reference}\n   */\n\n\n  limitToFirst(limit) {\n    return this.limit('limitToFirst', limit);\n  }\n  /**\n   *\n   * @param name\n   * @param limit\n   * @returns {Reference}\n   */\n\n\n  limit(name, limit) {\n    const newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n    newRef._query.limit(name, limit);\n\n    return newRef;\n  }\n  /**\n   * FILTERS\n   */\n\n  /**\n   *\n   * @param value\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  equalTo(value, key) {\n    return this.filter('equalTo', value, key);\n  }\n  /**\n   *\n   * @param value\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  endAt(value, key) {\n    return this.filter('endAt', value, key);\n  }\n  /**\n   *\n   * @param value\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  startAt(value, key) {\n    return this.filter('startAt', value, key);\n  }\n  /**\n   *\n   * @param name\n   * @param value\n   * @param key\n   * @returns {Reference}\n   */\n\n\n  filter(name, value, key) {\n    const newRef = new Reference(this._database, this.path, this._query.getModifiers());\n\n    newRef._query.filter(name, value, key);\n\n    return newRef;\n  }\n  /**\n   *\n   * @returns {OnDisconnect}\n   */\n\n\n  onDisconnect() {\n    return new OnDisconnect(this);\n  }\n  /**\n   * Creates a Reference to a child of the current Reference, using a relative path.\n   * No validation is performed on the path to ensure it has a valid format.\n   * @param {String} path relative to current ref's location\n   * @returns {!Reference} A new Reference to the path provided, relative to the current\n   * Reference\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#child}\n   */\n\n\n  child(path) {\n    return new Reference(this._database, `${this.path}/${path}`);\n  }\n  /**\n   * Return the ref as a path string\n   * @returns {string}\n   */\n\n\n  toString() {\n    return `${this._database.databaseUrl}${this.path}`;\n  }\n  /**\n   * Return a JSON-serializable representation of this object.\n   * @returns {string}\n   */\n\n\n  toJSON() {\n    return this.toString();\n  }\n  /**\n   * Returns whether another Reference represent the same location and are from the\n   * same instance of firebase.app.App - multiple firebase apps not currently supported.\n   * @param {Reference} otherRef - Other reference to compare to this one\n   * @return {Boolean} Whether otherReference is equal to this one\n   *\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#isEqual}\n   */\n\n\n  isEqual(otherRef) {\n    return !!otherRef && otherRef.constructor === Reference && otherRef.key === this.key && this._query.queryIdentifier() === otherRef._query.queryIdentifier();\n  }\n  /**\n   * GETTERS\n   */\n\n  /**\n   * The parent location of a Reference, or null for the root Reference.\n   * @type {Reference}\n   *\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#parent}\n   */\n\n\n  get parent() {\n    if (this.path === '/') return null;\n    return new Reference(this._database, this.path.substring(0, this.path.lastIndexOf('/')));\n  }\n  /**\n   * A reference to itself\n   * @type {!Reference}\n   *\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#ref}\n   */\n\n\n  get ref() {\n    return this;\n  }\n  /**\n   * Reference to the root of the database: '/'\n   * @type {!Reference}\n   *\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#root}\n   */\n\n\n  get root() {\n    return new Reference(this._database, '/');\n  }\n  /**\n   * INTERNALS\n   */\n\n  /**\n   * Generate a unique registration key.\n   *\n   * @return {string}\n   */\n\n\n  _getRegistrationKey(eventType) {\n    return `$${this._database.databaseUrl}$/${this.path}$${this._query.queryIdentifier()}$${listeners}$${eventType}`;\n  }\n  /**\n   * Generate a string that uniquely identifies this\n   * combination of path and query modifiers\n   *\n   * @return {string}\n   * @private\n   */\n\n\n  _getRefKey() {\n    return `$${this._database.databaseUrl}$/${this.path}$${this._query.queryIdentifier()}`;\n  }\n  /**\n   *\n   * @param obj\n   * @returns {Object}\n   * @private\n   */\n\n\n  _serializeObject(obj) {\n    if (!isObject(obj)) return obj; // json stringify then parse it calls toString on Objects / Classes\n    // that support it i.e new Date() becomes a ISO string.\n\n    return tryJSONParse(tryJSONStringify(obj));\n  }\n  /**\n   *\n   * @param value\n   * @returns {*}\n   * @private\n   */\n\n\n  _serializeAnyType(value) {\n    if (isObject(value)) {\n      return {\n        type: 'object',\n        value: this._serializeObject(value)\n      };\n    }\n\n    return {\n      type: typeof value,\n      value\n    };\n  }\n  /**\n   * Register a listener for data changes at the current ref's location.\n   * The primary method of reading data from a Database.\n   *\n   * Listeners can be unbound using {@link off}.\n   *\n   * Event Types:\n   *\n   * - value: {@link callback}.\n   * - child_added: {@link callback}\n   * - child_removed: {@link callback}\n   * - child_changed: {@link callback}\n   * - child_moved: {@link callback}\n   *\n   * @param {ReferenceEventType} eventType - Type of event to attach a callback for.\n   * @param {ReferenceEventCallback} callback - Function that will be called\n   * when the event occurs with the new data.\n   * @param {cancelCallbackOrContext=} cancelCallbackOrContext - Optional callback that is called\n   * if the event subscription fails. {@link cancelCallbackOrContext}\n   * @param {*=} context - Optional object to bind the callbacks to when calling them.\n   * @returns {ReferenceEventCallback} callback function, unmodified (unbound), for\n   * convenience if you want to pass an inline function to on() and store it later for\n   * removing using off().\n   *\n   * {@link https://firebase.google.com/docs/reference/js/firebase.database.Reference#on}\n   */\n\n\n  on(eventType, callback, cancelCallbackOrContext, context) {\n    if (!eventType) {\n      throw new Error('Query.on failed: Function called with 0 arguments. Expects at least 2.');\n    }\n\n    if (!isString(eventType) || !ReferenceEventTypes[eventType]) {\n      throw new Error(`Query.on failed: First argument must be a valid string event type: \"${Object.keys(ReferenceEventTypes).join(', ')}\"`);\n    }\n\n    if (!callback) {\n      throw new Error('Query.on failed: Function called with 1 argument. Expects at least 2.');\n    }\n\n    if (!isFunction(callback)) {\n      throw new Error('Query.on failed: Second argument must be a valid function.');\n    }\n\n    if (cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) && !isObject(context) && !isObject(cancelCallbackOrContext)) {\n      throw new Error('Query.on failed: Function called with 3 arguments, but third optional argument `cancelCallbackOrContext` was not a function.');\n    }\n\n    if (cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) && context) {\n      throw new Error('Query.on failed: Function called with 4 arguments, but third optional argument `cancelCallbackOrContext` was not a function.');\n    }\n\n    const eventRegistrationKey = this._getRegistrationKey(eventType);\n\n    const registrationCancellationKey = `${eventRegistrationKey}$cancelled`;\n\n    const _context = cancelCallbackOrContext && !isFunction(cancelCallbackOrContext) ? cancelCallbackOrContext : context;\n\n    const registrationObj = {\n      eventType,\n      ref: this,\n      path: this.path,\n      key: this._getRefKey(),\n      appName: this._database.app.name,\n      dbURL: this._database.databaseUrl,\n      eventRegistrationKey\n    };\n    SyncTree.addRegistration({ ...registrationObj,\n      listener: _context ? callback.bind(_context) : callback\n    });\n\n    if (cancelCallbackOrContext && isFunction(cancelCallbackOrContext)) {\n      // cancellations have their own separate registration\n      // as these are one off events, and they're not guaranteed\n      // to occur either, only happens on failure to register on native\n      SyncTree.addRegistration({\n        ref: this,\n        once: true,\n        path: this.path,\n        key: this._getRefKey(),\n        appName: this._database.app.name,\n        dbURL: this._database.databaseUrl,\n        eventType: `${eventType}$cancelled`,\n        eventRegistrationKey: registrationCancellationKey,\n        listener: _context ? cancelCallbackOrContext.bind(_context) : cancelCallbackOrContext\n      });\n    } // initialise the native listener if not already listening\n\n\n    getNativeModule(this._database).on({\n      eventType,\n      path: this.path,\n      key: this._getRefKey(),\n      appName: this._database.app.name,\n      modifiers: this._query.getModifiers(),\n      hasCancellationCallback: isFunction(cancelCallbackOrContext),\n      registration: {\n        eventRegistrationKey,\n        key: registrationObj.key,\n        registrationCancellationKey\n      }\n    }); // increment number of listeners - just a short way of making\n    // every registration unique per .on() call\n\n    listeners += 1; // return original unbound successCallback for\n    // the purposes of calling .off(eventType, callback) at a later date\n\n    return callback;\n  }\n  /**\n   * Detaches a callback previously attached with on().\n   *\n   * Detach a callback previously attached with on(). Note that if on() was called\n   * multiple times with the same eventType and callback, the callback will be called\n   * multiple times for each event, and off() must be called multiple times to\n   * remove the callback. Calling off() on a parent listener will not automatically\n   * remove listeners registered on child nodes, off() must also be called on any\n   * child listeners to remove the callback.\n   *\n   *  If a callback is not specified, all callbacks for the specified eventType will be removed.\n   * Similarly, if no eventType or callback is specified, all callbacks for the Reference will be removed.\n   * @param eventType\n   * @param originalCallback\n   */\n\n\n  off(eventType = '', originalCallback) {\n    if (!arguments.length) {\n      // Firebase Docs:\n      //     if no eventType or callback is specified, all callbacks for the Reference will be removed.\n      return SyncTree.removeListenersForRegistrations(SyncTree.getRegistrationsByPath(this.path));\n    }\n    /*\n     * VALIDATE ARGS\n     */\n\n\n    if (eventType && (!isString(eventType) || !ReferenceEventTypes[eventType])) {\n      throw new Error(`Query.off failed: First argument must be a valid string event type: \"${Object.keys(ReferenceEventTypes).join(', ')}\"`);\n    }\n\n    if (originalCallback && !isFunction(originalCallback)) {\n      throw new Error('Query.off failed: Function called with 2 arguments, but second optional argument was not a function.');\n    } // Firebase Docs:\n    //     Note that if on() was called\n    //     multiple times with the same eventType and callback, the callback will be called\n    //     multiple times for each event, and off() must be called multiple times to\n    //     remove the callback.\n    // Remove only a single registration\n\n\n    if (eventType && originalCallback) {\n      const registration = SyncTree.getOneByPathEventListener(this.path, eventType, originalCallback);\n      if (!registration) return []; // remove the paired cancellation registration if any exist\n\n      SyncTree.removeListenersForRegistrations([`${registration}$cancelled`]); // remove only the first registration to match firebase web sdk\n      // call multiple times to remove multiple registrations\n\n      return SyncTree.removeListenerRegistrations(originalCallback, [registration]);\n    } // Firebase Docs:\n    //     If a callback is not specified, all callbacks for the specified eventType will be removed.\n\n\n    const registrations = SyncTree.getRegistrationsByPathEvent(this.path, eventType);\n    SyncTree.removeListenersForRegistrations(SyncTree.getRegistrationsByPathEvent(this.path, `${eventType}$cancelled`));\n    return SyncTree.removeListenersForRegistrations(registrations);\n  }\n\n}"]},"metadata":{},"sourceType":"module"}