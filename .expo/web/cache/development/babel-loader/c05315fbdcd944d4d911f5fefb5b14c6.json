{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\orange7332\\\\capstone\\\\code-18122020-combined\\\\Screens\\\\MainFunctionScreen.js\";\nimport * as React from 'react';\nimport { useEffect } from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport firebase from 'firebase/app';\nimport \"firebase/auth\";\nimport 'firebase/database';\nimport NetInfo from \"@react-native-community/netinfo\";\n\nfunction MainFunctionScreen(_ref) {\n  var route = _ref.route,\n      navigation = _ref.navigation;\n  var data = route.params;\n\n  var _React$useState = React.useState(''),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      StartPower = _React$useState2[0],\n      setStartPower = _React$useState2[1];\n\n  var _React$useState3 = React.useState(''),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      EndPower = _React$useState4[0],\n      setEndPower = _React$useState4[1];\n\n  useEffect(function () {\n    setImmediate(function () {\n      return handleAuthStateChange();\n    });\n    clearImmediate;\n  });\n\n  var handleAuthStateChange = function handleAuthStateChange() {\n    var database = firebase.database();\n    var auth = firebase.auth();\n    auth.onAuthStateChanged(function (user) {\n      if (user) {\n        database.ref('/Socket ID/' + data.slice(17, 20)).once('value').then(function (snapshot) {\n          setStartPower(snapshot.val() && snapshot.val().Cumulative_Power);\n        });\n      } else {\n        database.ref('/Socket ID/' + data.slice(17, 20)).once('value').then(function (snapshot) {\n          setEndPower(snapshot.val() && snapshot.val().Cumulative_Power);\n        });\n      }\n\n      console.log(\"Start Power is \" + StartPower);\n      console.log(\"End Power is \" + EndPower);\n    });\n  };\n\n  var handleSignOut = function handleSignOut() {\n    var database = firebase.database();\n    var user = firebase.auth().currentUser;\n    var now = new Date();\n    var date = now.getMonth() + 1 + \"-\" + now.getDate() + \",\" + now.getHours() + \":\" + now.getMinutes();\n    firebase.auth().signOut();\n    database.ref('/Socket ID/' + data.slice(17, 20)).once('value').then(function (snapshot) {\n      database.ref('/Socket ID/' + data.slice(17, 20) + '/User_Activity/' + date).update({\n        Power_Consumed: snapshot.val() && snapshot.val().Cumulative_Power - StartPower,\n        User_Email: user.email,\n        User_ID: user.uid,\n        Time_of_Sign_Out: now + \"\"\n      }).then(function (data) {\n        console.log('data', data);\n      }).catch(function (error) {\n        console.log('error', error);\n      });\n      database.ref('/Usage History/' + user.uid).push({\n        Power_Consumed: snapshot.val() && snapshot.val().Cumulative_Power - StartPower,\n        Socket_Used: data.slice(17, 20),\n        Time_of_Sign_Out: now + \"\"\n      }).then(function (data) {\n        console.log('data', data);\n      }).catch(function (error) {\n        console.log('error', error);\n      });\n      setEndPower(snapshot.val() && snapshot.val().Cumulative_Power);\n    });\n    database.ref('/Socket ID/' + data.slice(17, 20)).update({\n      AppSwitch: 0,\n      Completion_Time: 0,\n      Current_User_Email: 'no user'\n    }).then(function (data) {\n      console.log('data', data);\n    }).catch(function (error) {\n      console.log('error', error);\n    });\n  };\n\n  var readDataforTimer = function readDataforTimer(_ref2) {\n    var data = _ref2.data;\n    firebase.database().ref('/Socket ID/' + data.slice(17, 20)).once('value').then(function (snapshot) {\n      var SocketStatus = snapshot.val() && snapshot.val().SocketOn;\n\n      if (SocketStatus == true) {\n        navigation.push(\"Set Timer\", data);\n      } else if (SocketStatus == false) {\n        alert('Socket has already been switched off');\n      } else {\n        alert('Please wait a while');\n      }\n    });\n  };\n\n  return React.createElement(ScrollView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: styles.Title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 17\n    }\n  }, \" Main Functions \"), React.createElement(Text, {\n    style: styles.Instructions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 17\n    }\n  }, \" Control your Aily socket here. You are connected to Socket No. \", data.slice(17, 20), \" \"), React.createElement(TouchableOpacity, {\n    style: styles.Navigation_Buttons,\n    onPress: function onPress() {\n      return navigation.navigate(\"Scan Now\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 17\n    }\n  }, React.createElement(Text, {\n    style: styles.Button_Text,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 21\n    }\n  }, \" Use a Different Aily Socket \")), React.createElement(TouchableOpacity, {\n    style: styles.Log_Out_Buttons,\n    onPress: function onPress() {\n      return handleSignOut() > navigation.navigate(\"Home\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 17\n    }\n  }, React.createElement(Text, {\n    style: styles.Button_Text,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 21\n    }\n  }, \" Log Out \"))));\n}\n\nvar styles = StyleSheet.create({\n  Connection_Connected: {\n    height: 70,\n    width: '100%',\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-evenly',\n    backgroundColor: '#00F000',\n    flexWrap: 'wrap'\n  },\n  Connection_Disconnected: {\n    height: 70,\n    width: '100%',\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-evenly',\n    backgroundColor: '#F00000',\n    flexWrap: 'wrap'\n  },\n  Connection_Text: {\n    textAlign: 'center',\n    color: \"#000000\",\n    fontWeight: \"300\",\n    marginTop: 50,\n    fontSize: 15\n  },\n  Disconnection_Text: {\n    textAlign: 'center',\n    color: \"#FFFFFF\",\n    fontWeight: \"300\",\n    marginTop: 50,\n    fontSize: 15\n  },\n  container: {\n    height: 575,\n    width: '100%',\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-evenly',\n    backgroundColor: '#fff',\n    flexWrap: 'wrap'\n  },\n  Title: {\n    textAlign: 'center',\n    marginLeft: 50,\n    marginRight: 50,\n    marginTop: 10,\n    marginBottom: 10,\n    color: \"#000\",\n    fontWeight: \"bold\",\n    fontSize: 25\n  },\n  Instructions: {\n    textAlign: 'center',\n    marginLeft: 50,\n    marginRight: 50,\n    marginTop: 0,\n    marginBottom: 0,\n    color: \"#000\",\n    fontWeight: \"300\",\n    fontSize: 15\n  },\n  Navigation_Buttons: {\n    backgroundColor: '#000080',\n    borderRadius: 4,\n    height: 125,\n    width: 125,\n    marginLeft: 5,\n    marginRight: 5,\n    marginTop: 15,\n    marginBottom: 15,\n    alignItems: 'center',\n    alignSelf: 'flex-start',\n    justifyContent: 'center'\n  },\n  Navigation_Buttons_Disabled: {\n    backgroundColor: '#AAAAAA',\n    borderRadius: 4,\n    height: 125,\n    width: 125,\n    marginLeft: 5,\n    marginRight: 5,\n    marginTop: 15,\n    marginBottom: 15,\n    alignItems: 'center',\n    alignSelf: 'flex-start',\n    justifyContent: 'center'\n  },\n  Log_Out_Buttons: {\n    backgroundColor: '#A00000',\n    borderRadius: 4,\n    height: 125,\n    width: 125,\n    marginLeft: 5,\n    marginRight: 5,\n    marginTop: 15,\n    marginBottom: 15,\n    alignItems: 'center',\n    alignSelf: 'flex-start',\n    justifyContent: 'center'\n  },\n  Button_Text: {\n    textAlign: 'center',\n    color: \"#FFF\",\n    fontWeight: \"600\"\n  }\n});\nexport default MainFunctionScreen;","map":{"version":3,"sources":["C:/Users/orange7332/capstone/code-18122020-combined/Screens/MainFunctionScreen.js"],"names":["React","useEffect","firebase","NetInfo","MainFunctionScreen","route","navigation","data","params","useState","StartPower","setStartPower","EndPower","setEndPower","setImmediate","handleAuthStateChange","clearImmediate","database","auth","onAuthStateChanged","user","ref","slice","once","then","snapshot","val","Cumulative_Power","console","log","handleSignOut","currentUser","now","Date","date","getMonth","getDate","getHours","getMinutes","signOut","update","Power_Consumed","User_Email","email","User_ID","uid","Time_of_Sign_Out","catch","error","push","Socket_Used","AppSwitch","Completion_Time","Current_User_Email","readDataforTimer","SocketStatus","SocketOn","alert","styles","container","Title","Instructions","Navigation_Buttons","navigate","Button_Text","Log_Out_Buttons","StyleSheet","create","Connection_Connected","height","width","flex","flexDirection","alignItems","justifyContent","backgroundColor","flexWrap","Connection_Disconnected","Connection_Text","textAlign","color","fontWeight","marginTop","fontSize","Disconnection_Text","marginLeft","marginRight","marginBottom","borderRadius","alignSelf","Navigation_Buttons_Disabled"],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {useEffect} from \"react\";\r\nimport { View, Text, TouchableOpacity, ScrollView, StyleSheet} from 'react-native';\r\nimport firebase from 'firebase/app';\r\nimport \"firebase/auth\";\r\nimport 'firebase/database';\r\n// import {useNetInfo} from \"@react-native-community/netinfo\";\r\nimport NetInfo from \"@react-native-community/netinfo\";\r\n\r\n \r\n \r\nfunction MainFunctionScreen( {route, navigation} ) {\r\n    let data  = route.params;\r\n\r\n    // const netInfo = useNetInfo();\r\n    const [StartPower, setStartPower] = React.useState('');\r\n    const [EndPower, setEndPower] = React.useState('');\r\n \r\n    useEffect(() => {\r\n        setImmediate(() => handleAuthStateChange());\r\n        clearImmediate;\r\n    });\r\n \r\nconst handleAuthStateChange = () => {\r\n        var database = firebase.database();\r\n        var auth = firebase.auth();\r\n \r\n        auth.onAuthStateChanged(function(user) {\r\n            if (user) {\r\n                database.ref('/Socket ID/' + data.slice(17,20)).once('value').then((snapshot) => {\r\n                setStartPower((snapshot.val() && snapshot.val().Cumulative_Power)) ;\r\n                })\r\n            }\r\n            else {\r\n                database.ref('/Socket ID/' + data.slice(17,20)).once('value').then((snapshot) => {\r\n                setEndPower((snapshot.val() && snapshot.val().Cumulative_Power)) ;\r\n                })\r\n            }\r\n            console.log(\"Start Power is \" + StartPower);\r\n            console.log(\"End Power is \" + EndPower);\r\n        });\r\n    }\r\n    \r\n      const handleSignOut = () => {\r\n        var database = firebase.database();\r\n        var user = firebase.auth().currentUser;\r\n        var now = new Date();\r\n        var date = (now.getMonth() + 1) + \"-\" + now.getDate() + \",\" + now.getHours() + \":\" + now.getMinutes();        \r\n        \r\n        firebase.auth().signOut()\r\n \r\n        database.ref('/Socket ID/' + data.slice(17,20)).once('value').then(function(snapshot) {\r\n            database.ref('/Socket ID/' + data.slice(17,20) + '/User_Activity/' + date).update({\r\n                Power_Consumed: snapshot.val() && snapshot.val().Cumulative_Power - StartPower,\r\n                User_Email: user.email,\r\n                User_ID: user.uid,\r\n                Time_of_Sign_Out: now + \"\"\r\n            }).then((data) => {\r\n                console.log('data', data)\r\n            }).catch((error) => {\r\n                console.log('error', error)\r\n            })\r\n \r\n            database.ref('/Usage History/' + user.uid).push({\r\n                Power_Consumed: snapshot.val() && snapshot.val().Cumulative_Power - StartPower,\r\n                Socket_Used: data.slice(17,20),\r\n                Time_of_Sign_Out: now + \"\"\r\n            }).then((data) => {\r\n                console.log('data', data)\r\n            }).catch((error) => {\r\n                console.log('error', error)\r\n            })\r\n \r\n            setEndPower((snapshot.val() && snapshot.val().Cumulative_Power)) ;\r\n        })\r\n \r\n \r\n        database.ref('/Socket ID/' + data.slice(17,20)).update({\r\n            AppSwitch: 0,\r\n            Completion_Time: 0,\r\n            Current_User_Email: 'no user'\r\n        }).then((data) => {\r\n            console.log('data', data)\r\n        }).catch((error) => {\r\n            console.log('error', error)\r\n        })\r\n    };\r\n \r\n \r\n    const readDataforTimer = ({data}) => {\r\n        firebase.database().ref('/Socket ID/' + data.slice(17,20)).once('value').then((snapshot) => {\r\n        var SocketStatus = (snapshot.val() && snapshot.val().SocketOn) ;\r\n        \r\n        if(SocketStatus == true){\r\n            navigation.push(\"Set Timer\", data);\r\n        }\r\n        else if(SocketStatus == false){\r\n            alert('Socket has already been switched off');\r\n        }\r\n \r\n        else {\r\n            alert('Please wait a while');\r\n        }\r\n        })        \r\n    };\r\n    \r\n        return (\r\n        <ScrollView>\r\n            {/* <View style={(netInfo.isConnected) ? styles.Connection_Connected: styles.Connection_Disconnected}>\r\n                <Text style = {(netInfo.isConnected) ? styles.Connection_Text: styles.Disconnection_Text}> \r\n                    {(netInfo.isConnected === true)? 'You are connected to the device' : 'You are disconnected from the device'} \r\n                </Text>\r\n            </View> */}\r\n            \r\n            <View style={styles.container}>\r\n                <Text style = {styles.Title}> Main Functions </Text>\r\n                <Text style = {styles.Instructions}> Control your Aily socket here. You are connected to Socket No. {data.slice(17,20)} </Text>\r\n \r\n                {/* <TouchableOpacity\r\n                    style={(netInfo.isConnected) ? styles.Navigation_Buttons : styles.Navigation_Buttons_Disabled}\r\n                    disabled = {(netInfo.isConnected === false)}\r\n                    onPress={() => navigation.push(\"On Off\", data)}\r\n                >\r\n                    <Text style = {styles.Button_Text}> Switch on/off socket </Text>\r\n                </TouchableOpacity>    */}\r\n \r\n                {/* <TouchableOpacity\r\n                    style={(netInfo.isConnected) ? styles.Navigation_Buttons : styles.Navigation_Buttons_Disabled}\r\n                    disabled = {(netInfo.isConnected === false)}\r\n                    onPress={() => readDataforTimer({data}) }\r\n                >\r\n                    <Text style = {styles.Button_Text}> Switch on/off socket via schedule </Text>\r\n                </TouchableOpacity>    */}\r\n \r\n                {/* <TouchableOpacity\r\n                    style={(netInfo.isConnected) ? styles.Navigation_Buttons : styles.Navigation_Buttons_Disabled}\r\n                    disabled = {(netInfo.isConnected === false)}\r\n                    onPress={() => navigation.push(\"Power Usage\", {data, StartPower})}\r\n                >\r\n                    <Text style = {styles.Button_Text}> Check Power Consumption Here </Text>\r\n                </TouchableOpacity>   \r\n \r\n                <TouchableOpacity\r\n                    style={(netInfo.isConnected) ? styles.Navigation_Buttons : styles.Navigation_Buttons_Disabled}\r\n                    disabled = {(netInfo.isConnected === false)}\r\n                    onPress={() => navigation.push(\"Past Usage\", {StartPower, EndPower})}\r\n                >\r\n                    <Text style = {styles.Button_Text}> Past Usage of Aily Sockets </Text>\r\n                </TouchableOpacity> */}\r\n \r\n                <TouchableOpacity\r\n                    style={styles.Navigation_Buttons}\r\n                    onPress={() => navigation.navigate(\"Scan Now\")}\r\n                >\r\n                    <Text style = {styles.Button_Text}> Use a Different Aily Socket </Text>\r\n                </TouchableOpacity>   \r\n \r\n                <TouchableOpacity\r\n                    style={styles.Log_Out_Buttons}\r\n                    onPress={() => handleSignOut() > navigation.navigate(\"Home\")}\r\n                >\r\n                    <Text style = {styles.Button_Text}> Log Out </Text>\r\n                </TouchableOpacity>   \r\n \r\n            </View>\r\n        </ScrollView>\r\n      \r\n    );\r\n}\r\n \r\n \r\nconst styles = StyleSheet.create({\r\n    Connection_Connected: {\r\n        height: 70,\r\n        width : '100%',\r\n        flex : 1,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-evenly',\r\n        backgroundColor: '#00F000',\r\n        flexWrap: 'wrap',\r\n    },\r\n \r\n    Connection_Disconnected: {\r\n        height: 70,\r\n        width : '100%',\r\n        flex : 1,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-evenly',\r\n        backgroundColor: '#F00000',\r\n        flexWrap: 'wrap',\r\n    },\r\n \r\n    Connection_Text: {\r\n        textAlign: 'center',\r\n        color: \"#000000\", \r\n        fontWeight: \"300\", \r\n        marginTop: 50,\r\n        fontSize: 15\r\n    },\r\n \r\n    Disconnection_Text: {\r\n        textAlign: 'center',\r\n        color: \"#FFFFFF\", \r\n        fontWeight: \"300\", \r\n        marginTop: 50,\r\n        fontSize: 15\r\n    },\r\n    \r\n    container: {\r\n        height: 575,\r\n        width : '100%',\r\n        flex : 1,\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-evenly',\r\n        backgroundColor: '#fff',\r\n        flexWrap: 'wrap',\r\n    },\r\n \r\n    Title: {\r\n        textAlign: 'center',\r\n        marginLeft: 50,\r\n        marginRight: 50,\r\n        marginTop: 10,\r\n        marginBottom: 10,\r\n        color: \"#000\", \r\n        fontWeight: \"bold\", \r\n        fontSize: 25\r\n    },\r\n \r\n    Instructions: {\r\n        textAlign: 'center',\r\n        marginLeft: 50,\r\n        marginRight: 50,\r\n        marginTop: 0,\r\n        marginBottom: 0,\r\n        color: \"#000\", \r\n        fontWeight: \"300\", \r\n        fontSize: 15\r\n    },\r\n \r\n    Navigation_Buttons: {\r\n        backgroundColor : '#000080',\r\n        borderRadius : 4,\r\n        height: 125,\r\n        width : 125,\r\n        marginLeft: 5,\r\n        marginRight: 5,\r\n        marginTop: 15,\r\n        marginBottom: 15,\r\n        alignItems: 'center',\r\n        alignSelf: 'flex-start',\r\n        justifyContent: 'center'\r\n    },\r\n \r\n    Navigation_Buttons_Disabled: {\r\n        backgroundColor : '#AAAAAA',\r\n        borderRadius : 4,\r\n        height: 125,\r\n        width : 125,\r\n        marginLeft: 5,\r\n        marginRight: 5,\r\n        marginTop: 15,\r\n        marginBottom: 15,\r\n        alignItems: 'center',\r\n        alignSelf: 'flex-start',\r\n        justifyContent: 'center'\r\n    },\r\n \r\n    Log_Out_Buttons: {\r\n        backgroundColor : '#A00000',\r\n        borderRadius : 4,\r\n        height: 125,\r\n        width : 125,\r\n        marginLeft: 5,\r\n        marginRight: 5,\r\n        marginTop: 15,\r\n        marginBottom: 15,\r\n        alignItems: 'center',\r\n        alignSelf: 'flex-start',\r\n        justifyContent: 'center'\r\n    },\r\n \r\n    Button_Text: {\r\n        textAlign: 'center',\r\n        color: \"#FFF\",\r\n        fontWeight: \"600\"\r\n    }\r\n});\r\n \r\nexport default MainFunctionScreen;\r\n \r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}